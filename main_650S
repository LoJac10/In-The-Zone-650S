#pragma config(UART_Usage, UART2, uartVEXLCD, baudRate19200, IOPins, None, None)
#pragma config(Sensor, in1,    power,         sensorAnalog)
#pragma config(Sensor, dgtl1,  quadL,          sensorQuadEncoder)
#pragma config(Sensor, dgtl3,  quadR,          sensorQuadEncoder)
#pragma config(Motor,  port1,           claw,          tmotorVex393_HBridge, openLoop)
#pragma config(Motor,  port2,           mogoR,     			tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port3,           mogoL,     			tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port4,          	elevatorL,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port5,           elevatorR,         tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port6,           armL,          tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port7,           armR,          tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port8,           driveL,        tmotorVex393_MC29, openLoop, driveLeft)
#pragma config(Motor,  port9,           driveR,        tmotorVex393_MC29, openLoop, driveRight)
#pragma config(Motor,  port10,           ,             tmotorVex393_HBridge, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard                  !!*//

//////////////////////////////////////////////////////////////////////////////////////////
//
//	COMPONENT TITLE: PROGRAM FOR ROBOT 650S	
//	PROJECT TITLE:	VEX ROBOTIC COMPEITION 2K17_18
//	PROGRAM AUTHOR(S): NMS ROBOTICS TEAM
//
//////////////////////////////////////////////////////////////////////////////////////////

#pragma platform(VEX2)
#pragma competitionControl(Competition)
#include "Vex_Competition_Includes.c" 

#include "OPsubsystems.c"			// operator subsystems file
#include "util.c"				// utility functions file
#include "batt.c"				// battery functions file

#define PI 3.14159265359			// redefine of PI to more accurate setting
#define WHEEL_DIAMETER 4			// set the wheel diameter in inches
#define WHEEL_CIRC WHEEL_DIAMETER*PI		// circumference of wheel measurement calc
#define DEADBAND 25				// deadband threshold set to 25 power level
#define MOGO_STANDARD 120			// mobile goal standard power setting 
#define ARMSPEED_STANDARD 120			// arms from tower standard power setting
#define CLAWSPEED_STANDARD 100			// claw standard power setting
#define SPEED393_STANDARD 100			// default motor 393 standard power setting
//#define SPEED393_HIGHSPEED 160		// default motor 393 Highspeed power setting

//////////////////////////////////////////////////////////////////////////////////////////
//
//                          GLOBAL VARIABLES																						//
//
// 	You may want to create some user defined functions for your program.
//
//////////////////////////////////////////////////////////////////////////////////////////

int autonomousMode = 1;						//default value for autonomous mode
int driverControlModeCount = 1;

//////////////////////////////////////////////////////////////////////////////////////////
//																											//
//                          CONSTANT VARIABLES																					//
//																												//
// 	You may want to create some user constant variables for your program.
//
//////////////////////////////////////////////////////////////////////////////////////////

//const float EFFECTIVE_CIRC = WHEEL_CIRC*sqrt(2);
//const float TICKS_PER_REVOLUTION = 627.2;
//const int MAX_OUT = MAX_MOTOR_POWER_FWD;

//------------------------------------------------------------------------------------------ GLOBAL VARIABLES

	int q1, q2, q3, q4;					// variables to record distance for testing
	
	int encoderTicks = 360; 				// number of ticks in a revolution.
								// QSE = 360. IEM = 627.2 @ 100rpm gearing.
								// 392 @ 160 rpm gearing
								
	//int mogoSpeed;					// power setting for mobile goals
	//int mogoMsec;						// wait time for mobile goals
								
								// called in encoder functions.
								// use float and 10.16 for cm.		
	int ticksPerInch = encoderTicks / WHEEL_CIRC; 		// calc to gen #ticks / inch.

	int varSysTime = nSysTime;


// OPsubsystems.c
// util.c



///////////////////////////////////////////////////////////////////////////////////////////////////// 
//
//	AUTON USER FUNCTIONS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------	DRIVE FUNCTIONS: FORWARD
void autoDrive(int speed){
	motor[driveR] = -speed;					// 'Y' motors RightFront and RightBack
	motor[driveL] = speed;					// 'Y' motors LeftFront and LeftBack
	//motor[] = speed;					// open commmand for programming motors individually
	//motor[] = speed;					// open commmand for programming motors individually
}

/*
void autoDriveTime(int speed, int mSec){
	autoDrive(speed);
	wait1Msec(mSec);
	autoDrive(0);
}
*/

void clearEncoders(){
	SensorValue[quadL] = 0;
	SensorValue[quadR] = 0;
}

void autoDriveDist(int speed, int dist){
	int tickGoal = ticksPerInch * dist;

	/*
	while((abs(SensorValue[quadL])) < tickGoal * 0.6){
		//check for right encoder differences
		int rDiff = abs((SensorValue[quadL])) - abs(SensorValue[quadR]);
		//rMod = 10% speed n the direction of rDiff
		int rMod = sgn(rDiff)*speed*0.1;
	}
	*/

	while(abs(SensorValue[quadL]) < tickGoal){
			autoDrive(speed);
		}
		autoDrive(0);
	}

void raiseMogo(int mogoSpeed, int mogoMsec){
		motor[mogoL] = mogoSpeed;
		motor[mogoR] = -mogoSpeed;
		wait1Msec(mogoMsec);
}

void lowerMogo(int mogoSpeed, int mogoMsec){
		motor[mogoL] = -mogoSpeed;
		motor[mogoR] = mogoSpeed;
		wait1Msec(mogoMsec);
}

void stopMOGO(){
	motor[mogoL] = 0;
	motor[mogoR] = 0;
	}


//------------------------------------------------------------------------------------------	DRIVE FUNCTIONS:TURN FUNCTIONS

//function to turn the robot at a specified speed
//positive speed = turn right, negative speed = turn left

void
autoturn(int speed){
	motor[driveR] = speed;
	motor[driveL] = speed;
	//motor[] = speed;	//open commmand encase of programming motors individually
	//motor[] = speed; 	//open commmand encase of programming motors individually
}

/*
void autoDriveTime(int speed, int mSec){
	autoDrive(speed);
	wait1Msec(mSec);
	autoDrive(0);
}
*/

void autoTurnDist(int speed, int dist){
	int tickGoal = ticksPerInch * dist;
		while(abs(SensorValue[quadL]) < tickGoal)
		{
			autoturn(speed);
		}
	autoturn(0);
}



//////////////////////////////////////////////////////////////////////////////////////////
//																																											//
//	USER DEFINED FUNCTIONS																				//
//	FOR PROGRAM CONTROL & LCD DISPLAY																//
//																																																									//
//////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------ FUNCTION: PLACE HOLDER LCD DISPLAY INFO
void
nothingOnScreen(){
	displayLCDCenteredString(0, "Currently"); 		// Msg Output to 1st line of LCD
	displayLCDCenteredString(1, "Empty");			// Msg Output to 2nd line of LCD
}

//------------------------------------------------------------------------------------------ FUNCTION: LCD DISPLAY OF ENCODER VALUES
void
displayEncoderValues(){
	displayLCDCenteredString(0,"Left      Right");
	displayLCDNumber(1,1,SensorValue[driveL],5);
	displayLCDNumber(1,9,SensorValue[driveR],5);
	if(nLCDButtons == 2){
		SensorValue[driveL] = 0;
		SensorValue[driveR] = 0;
	}
}

//------------------------------------------------------------------------------------------ FUNCTION: DISPLAY MAIN BATTERY VOLTAGE VIA LCD
// batt.c

//------------------------------------------------------------------------------------------ FUNCTION: AUTON PROGRAM SWAP OPTION
void
swapAuton(){
	displayLCDCenteredString(0,"Autonomous");
	displayLCDCenteredString(1,"Swap");
	displayLCDNumber(0,14,autonomousMode,2);

	if(nLCDButtons == 2){
		autonomousMode++;
		while(nLCDButtons == 2){wait1Msec(10);}
	}

	if(autonomousMode > 12){
		autonomousMode = 1;
	}
}

//------------------------------------------------------------------------------------------ FUNCTION: AUTON MODE LCD START OPTION
void
startAuton(){
	displayLCDCenteredString(0, "press center to");
	displayLCDCenteredString(1, "start autonomous");
}

//////////////////////////////////////////////////////////////////////////////////////////
//																																											//
//	AUTONOMOUS MODE																				//
//	SETUP SECTION																					//
//																																											//
//////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------ FUNCTION: AUTON MODE SELECTOR PROGRAM

void
autonomousSelection(){
	//Turn on the LCD backlight
	bLCDBacklight = true;
	//Func call to clear LCD screen
	clearLCD();

	while(nLCDButtons != 2)
	{
		displayLCDCenteredString(0,"Autonomous");
		displayLCDNumber(0,14,autonomousMode, 2);
		displayLCDCenteredString(1,"<< Selection >>");
		if(nLCDButtons == 1){
			autonomousMode--;
			while(nLCDButtons == 1){wait1Msec(10);}
		}
		if(nLCDButtons == 4){
			autonomousMode++;
			while(nLCDButtons == 4){wait1Msec(10);}
		}
		if(autonomousMode < 1){
			autonomousMode = 12;
		}
		else if(autonomousMode > 12){
			autonomousMode = 1;
		}
		wait1Msec(10);
	}

	//clear the LCD screen
	clearLCD();

	//Turn off LCD backlight
	bLCDBacklight = false;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	FUNCTION -- 12 AUTONOMOUS MODE PROGRAM SLOTS
//
//////////////////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------ AUTONOMOUS PROGRAM #1
void
autonomous1(){
	clearEncoders();				// clear sensor for clean start
	lowerMogo(60, 1000);				// lower MOGO
	//lowerMogo(0, 250);

	// straight run command: part 1 -- LOW POWER FOR ALIGN
	autoDriveDist(60,30);
	clearEncodersQuad();
	// straight run command: part 2 -- POWER UP TO GRAB MOGO
	autoDriveDist(95,20);
	raiseMogo(90, 500);
	stopMOGO();
	// raise MOGO after retrieve MOGO
	//raiseMogo(0, 250);
	wait1Msec(500);
	clearEncodersQuad();

	//------------------------------------------------------------------------------------------

	// back up for clearing MOGO pick area with cones obstacles
	autoDriveDist(-70,40);
	clearEncodersQuad();

	// turn command to drive forward to position robot in center of score zone
	autoTurnDist(-50,20);
	clearEncodersQuad();

	// straight run command to position robot in center of score zone
	autoDriveDist(60,10); // distance to MOGO target
	clearEncodersQuad();

	//------------------------------------------------------------------------------------------

	// turn to face score corner
	autoTurnDist(-60,8);
	clearEncodersQuad();

	// straight run to enter score zone -- POWER UP
	autoDriveDist(120,17);
	
	// motor[driveR] = -120;		// max power
	// motor[driveL] = 120;		// max power
	clearEncodersQuad();


	// lower MOGO
	lowerMogo(120,1000);
	clearEncodersQuad();

	// back up for dropping MOGO -- POWER UP
	autoDriveDist(-120,17);
	clearEncodersQuad();
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #2
void
autonomous2(){
	//insert autonomous mode program #2 below
	//remove this func when you place your assigned func to this slot
	nothingOnScreen();
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #3
void
autonomous3(){
	//insert autonomous mode program #3 below
	//remove this func when you place your assigned func to this slot
	nothingOnScreen();
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #4
void
autonomous4(){
	//insert autonomous mode program #4 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #5
void
autonomous5(){
	//insert autonomous mode program #5 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #6
void
autonomous6(){
	//insert autonomous mode program #6 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #7
void
autonomous7(){
	//insert autonomous mode program #7 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #8
void
autonomous8(){
	//insert autonomous mode program #8 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #9
void
autonomous9(){
	//insert autonomous mode program #9 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #10
void
autonomous10(){
	//insert autonomous mode program #10 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #11
void
autonomous11(){
	//insert autonomous mode program #11 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//------------------------------------------------------------------------------------------ AUTON PROGRAM #12
void
autonomous12(){
	//insert autonomous mode program #12 below
	nothingOnScreen(); //remove this func when you place your assigned func to this slot
}

//////////////////////////////////////////////////////////////////////////////////////////
//																																											//
//	DRIVER CONTROL MODE																		//
//	TASK SETUP SECTION																		//
//																																											//
//////////////////////////////////////////////////////////////////////////////////////////

/*=======================================================================================*\
|				DRIVER CONTROL MODE 																	|
|				BASIC ROBOT OPERATION TASKS 														|
/*=======================================================================================*/

/*---------------------------------------------------------------------------------------*\
DESCRIPTION:	TASK TO IMPLEMENT DRIVE TRAIN FUNCTIONS
/*---------------------------------------------------------------------------------------*/
task
driveBase_t(){
	while(true){
		driveTrain_func();
	}
}

/*---------------------------------------------------------------------------------------*\
DESCRIPTION:	TASK TO IMPLEMENT TOWER LIFT FUNCTIONS
/*---------------------------------------------------------------------------------------*/
task
towerLift_t(){
	while(true){
		towerLift_func();
	}
}

/*---------------------------------------------------------------------------------------*\
DESCRIPTION:	TASK TO IMPLEMENT ARM LIFT FUNCTIONS
/*---------------------------------------------------------------------------------------*/
task
armLift_t(){
	while(true){
		armLift_func();
	}
}

/*---------------------------------------------------------------------------------------*\
DESCRIPTION:	TASK TO IMPLEMENT MOGO LIFT FUNCTIONS		
/*---------------------------------------------------------------------------------------*/
task
shovelLift_t(){
	while(true){
		shovelLift_func();
	}
}

/*---------------------------------------------------------------------------------------*\
DESCRIPTION:	TASK TO IMPLEMENT CLAW FUNCTIONS	
/*---------------------------------------------------------------------------------------*/
task
claw_t(){
	while(true){
		claw_func();
	}
}

/*=======================================================================================*\
|				DRIVER CONTROL MODE 																 			|
|				DISPLAY TASK SETUP SECTION &								 									|
|				DRIVER MODE DISPLAY PROGRAMS														 			|
/*=======================================================================================*/

/*---------------------------------------------------------------------------------------*\
TYPE:						TASK
DESCRIPTION:		DRIVER CONTROL VIEW VALUES FOR LCD DISPLAY
BONAFIDES:
/*---------------------------------------------------------------------------------------*/
task
driverControlViewValues(){
	//Turn on LCD backlight
	bLCDBacklight = true;
	//Func call to clear LCD screen
	clearLCD();

	while(true){
		if(nLCDButtons == 1){
			driverControlModeCount--;
			//Func call to clear LCD screen
			clearLCD();
			while(nLCDButtons == 1){wait1Msec(10);}
		}
		if(nLCDButtons == 4){
			driverControlModeCount++;
			clearLCD();
			while(nLCDButtons == 1){wait1Msec(10);}
		}
		if(driverControlModeCount < 1){
			driverControlModeCount = 12;
		}
		else if (driverControlModeCount > 12){
			driverControlModeCount = 1;
		}

		// ...........................................................................................
		//	List below are 12 drive controll mode program call slots
		//	If a program is not installed for slot (case) then LCD reads "Nothing On Screen"
		//	There are 12 possible slots (cases) for driver controll programs to be inserted
		//	The number of 12 program slots (cases) was chosen at random and has no specific reasoning
		// ............................................................................................

		switch
		(driverControlModeCount){
		//--------------------------------------------------------------------------------------
		case 1:
			// driver control mode program #1: 
			// DISPLAY BATTERY VOLTAGE PROGRAM
			monitorPower();
			break;
		//--------------------------------------------------------------------------------------
		case 2:
			// driver control mode program #2: 
			// SWAP AUTONOMOUS MODE PROGRAMS OPTION
			swapAuton();
			break;
		//--------------------------------------------------------------------------------------
		case 3:
			// driver control mode program #3: 
			// START AUTONOMOUS MODE PROGRAMS OPTION
			startAuton();
			break;
		//--------------------------------------------------------------------------------------
		case 4:
			// driver control mode program #4: 
			// DISPLAY ENCODER VALUES
			displayEncoderValues();
			break;
		//--------------------------------------------------------------------------------------
		case 5:
			//insert driver control mode program #5 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 6:
			//insert driver control mode program #6 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 7:
			//insert driver control mode program#7 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 8:
			//insert driver control mode program #8 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 9:
			//insert driver control mode program #9 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 10:
			//insert driver control mode program #10 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 11:
			//insert driver control mode program #11 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		case 12:
			//insert driver control mode program #12 below -- CURRENTLY EMPTY
			nothingOnScreen(); // remove this func when you place your assigned func to this slot
			break;
		//--------------------------------------------------------------------------------------
		default:
			//insert driver control mode program #1 below
			monitorPower();
		//--------------------------------------------------------------------------------------
		}
		wait1Msec(10);
	}

	//Func call to clear LCD screen
	clearLCD();

	//Turn off LCD backlight
	bLCDBacklight = false;
}

//////////////////////////////////////////////////////////////////////////////////////////
//																											//
//                          PRE-AUTONOMOUS FUNCTIONS
//
// 	You may want to perform some actions before the competition starts. Do them in the
// 	following function.																																	//
//
//////////////////////////////////////////////////////////////////////////////////////////

void
pre_auton(){
	//zeroEncoders_func();
	autonomousSelection();
	bStopTasksBetweenModes = true;

}

//////////////////////////////////////////////////////////////////////////////////////////
//
//                                 AUTONOMOUS TASK 																			//
//
// 	This task is used to control your robot during the autonomous phase of a VEX 	
//	Competition. You must modify the code to add your own robot specific commands here.
//
//////////////////////////////////////////////////////////////////////////////////////////

task
autonomous(){
	switch(autonomousMode){
	//--------------------------------------------------------------------------------------
	case 1:
	// currently empty -- referencing autonomous mode function #1
		autonomous1();				
		break;
	//--------------------------------------------------------------------------------------
	case 2:
	// currently empty -- referencing autonomous mode function #2
		autonomous2();				
		break;
	//--------------------------------------------------------------------------------------
	case 3:
	// currently empty -- referencing autonomous mode function #3
		autonomous3();				
		break;
	//--------------------------------------------------------------------------------------
	case 4:
	// currently empty -- referencing autonomous mode function #4
		autonomous4();				
		break;
	//--------------------------------------------------------------------------------------
	case 5:
	//currently empty -- referencing autonomous mode function #5
		autonomous5();				
		break;
	//--------------------------------------------------------------------------------------
	case 6:
	//currently empty -- referencing autonomous mode function #6
		autonomous6();				
		break;
	//--------------------------------------------------------------------------------------
	case 7:
	//currently empty -- referencing autonomous mode function #7
		autonomous7();				
		break;
	//--------------------------------------------------------------------------------------
	case 8:
	//currently empty -- referencing autonomous mode function #8
		autonomous8();				
		break;
	//--------------------------------------------------------------------------------------
	case 9:
	//currently empty -- referencing autonomous mode function #9
		autonomous9();				
		break;
	//--------------------------------------------------------------------------------------
	case 10:
	//currently empty -- referencing autonomous mode function #10
		autonomous10();				
		break;
	//--------------------------------------------------------------------------------------
	case 11:
	//currently empty -- referencing autonomous mode function #11
		autonomous11();				
		break;
	//--------------------------------------------------------------------------------------
	case 12:
	//currently empty -- referencing autonomous mode function #12
		autonomous12();				
		break;
	//--------------------------------------------------------------------------------------
	default:
	//default autonomous program -- referencing autonomous mode function #1
		autonomous1();				
	//--------------------------------------------------------------------------------------
	}
	wait1Msec(2000);
}

//////////////////////////////////////////////////////////////////////////////////////////
//																												//
//                                 USER CONTROL TASK																		//
//																											//
// 	This task is used to control your robot during the user control phase of a VEX 		
//	Competition. You must modify the code to add your own robot specific commands here.
//
//////////////////////////////////////////////////////////////////////////////////////////

task
usercontrol(){
	clearLCD();
	startTask(driverControlViewValues);
	while(true){
		//use lcd to start autonomous or button 7R on controller
		if((driverControlModeCount == 3) && (nLCDButtons == 2)||(vexRT[Btn7R] == 1)){
				startTask(autonomous);
				wait1Msec(15000);
				stopTask(autonomous);
			}
		//main program
		startTask(driveBase_t);
		startTask(towerLift_t);
		startTask(armLift_t);
		startTask(shovelLift_t);
		startTask(claw_t);
		startTask(usercontrol);
	}
}
